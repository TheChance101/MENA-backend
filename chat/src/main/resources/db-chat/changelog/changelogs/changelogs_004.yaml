databaseChangeLog:
  - changeSet:
      id: 7-chat
      author: omer-faris
      comment: create chat table
      changes:
        - sql:
            sql:
              CREATE TABLE IF NOT EXISTS chat.chats(
                id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                is_group BOOLEAN NOT NULL
              );

  - changeSet:
      id: 8-chat
      author: omer-faris
      comment: create group_chats table
      changes:
        - sql:
            sql:
              CREATE TABLE IF NOT EXISTS chat.group_chats(
                chat_id UUID PRIMARY KEY,
                group_name VARCHAR(255) NOT NULL,
                group_image_url VARCHAR(512),
                CONSTRAINT fk_group_chat_chat FOREIGN KEY(chat_id) REFERENCES chat.chats(id) ON DELETE CASCADE
              );

  - changeSet:
      id: 9-chat
      author: omer-faris
      comment: create messages table
      changes:
        - sql:
            sql:
              CREATE TABLE IF NOT EXISTS chat.messages(
              id UUID PRIMARY KEY,
              chat_id UUID NOT NULL,
              sender_id UUID NOT NULL,
              text TEXT NOT NULL,
              send_at TIMESTAMP NOT NULL DEFAULT NOW(),
              CONSTRAINT fk_messages_chat FOREIGN KEY(chat_id) REFERENCES chat.chats(id) ON DELETE CASCADE
              );

  - changeSet:
      id: 10-chat
      author: omer-faris
      comment: create chat_users join table
      changes:
        - sql:
            sql:
              CREATE TABLE IF NOT EXISTS chat.chat_users(
                chat_id UUID NOT NULL,
                user_id UUID NOT NULL,
                PRIMARY KEY (chat_id, user_id),
                CONSTRAINT fk_chat_users_chat FOREIGN KEY(chat_id) REFERENCES chat.chats(id) ON DELETE CASCADE,
                CONSTRAINT fk_chat_users_user FOREIGN KEY(user_id) REFERENCES chat.users_of_contacts(id) ON DELETE CASCADE
              );

  - changeSet:
      id: 11-chat
      author: omer-faris
      comment: create message_reed table
      changes:
        - sql:
            sql:
              CREATE TABLE IF NOT EXISTS chat.message_reed(
              user_id UUID NOT NULL,
              message_id UUID NOT NULL,
              PRIMARY KEY (user_id, message_id),
              CONSTRAINT fk_message_reed FOREIGN KEY(message_id) REFERENCES chat.messages(id) ON DELETE CASCADE
              );
