databaseChangeLog:
  - changeSet:
      id: 7-chat
      author: omer-faris
      comment: create chat table
      changes:
        - sql:
            sql:
              CREATE TABLE IF NOT EXISTS chat.chats(
                id UUID PRIMARY KEY DEFAULT gen_random_uuid()
              );

  - changeSet:
      id: 9-chat
      author: omer-faris
      comment: create messages table
      changes:
        - sql:
            sql:
              CREATE TABLE IF NOT EXISTS chat.messages(
                id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                chat_id UUID NOT NULL,
                sender_id UUID NOT NULL,
                text TEXT NOT NULL,
                is_read BOOLEAN NOT NULL DEFAULT FALSE,
                send_at TIMESTAMP NOT NULL DEFAULT NOW(),
                CONSTRAINT fk_messages_chat FOREIGN KEY(chat_id) REFERENCES chat.chats(id) ON DELETE CASCADE
              );

  - changeSet:
      id: 10-chat
      author: omer-faris
      comment: create chat_users join table
      changes:
        - sql:
            sql:
              CREATE TABLE IF NOT EXISTS chat.chat_users(
                chat_id UUID NOT NULL,
                user_id UUID NOT NULL,
                PRIMARY KEY (chat_id, user_id),
                CONSTRAINT fk_chat_users_chat FOREIGN KEY(chat_id) REFERENCES chat.chats(id) ON DELETE CASCADE,
                CONSTRAINT fk_chat_users_user FOREIGN KEY(user_id) REFERENCES chat.users_of_contacts(id) ON DELETE CASCADE
              );
